- hosts: all

  tasks:

    - name: Get fzf
      unarchive:
        src: https://github.com/junegunn/fzf-bin/releases/download/{{ version }}/fzf-{{ version }}-{{ os }}_amd64.tgz
        dest: "{{ target_directory }}/.bin/"
        creates: "{{ target_directory }}/.bin/fzf"
        remote_src: yes
      vars:
        version: 0.17.5


    - name: Check for hub
      stat:
        path: "{{ target_directory }}/.bin/hub"
      register: hub_stat_result
    - name: Get hub
      get_url:
        url: https://github.com/github/hub/releases/download/v{{ version }}/hub-{{ os }}-amd64-{{ version }}.tgz
        dest: "/tmp/hub.tgz"
      vars:
        version: 2.10.0
      when: not hub_stat_result.stat.exists
      register: hub_download
    - name: Unpack hub
      shell: |
        {{ tar | default('tar') }} \
        --extract \
        --verbose \
        --file hub.tgz \
        --wildcards \
        --strip-component 2 \
        --directory {{ target_directory }}/.bin/ \
        "*/hub"
      args:
        chdir: /tmp/
        creates: "{{ target_directory }}/.bin/hub"
        warn: false
      when: hub_download is not skipped and hub_download is success
    - name: Unpack hub completions
      shell: |
        {{ tar | default('tar') }} \
        --extract \
        --verbose \
        --show-transformed-names \
        --file hub.tgz \
        --wildcards \
        --strip-component 2 \
        --directory "{{ target_directory }}/.zsh/completions.d/" \
        --transform "s/hub.zsh_completion/_hub/" \
        "*/etc/hub.zsh_completion"
      args:
        chdir: /tmp/
        creates: "{{ target_directory }}/.zsh/completions.d/_hub"
      when: hub_download is not skipped and hub_download is success


    - name: Get pup
      unarchive:
        src: https://github.com/ericchiang/pup/releases/download/{{ version }}/pup_{{ version }}_{{ os }}_amd64.zip
        dest: "{{ target_directory }}/.bin/"
        creates: "{{ target_directory }}/.bin/pup"
        remote_src: yes
      vars:
        version: v0.4.0


    - name: Get Packer
      unarchive:
        src: https://releases.hashicorp.com/packer/{{ version }}/packer_{{ version }}_{{ os }}_amd64.zip
        dest: "{{ target_directory }}/.bin/"
        creates: "{{ target_directory }}/.bin/packer"
        remote_src: yes
      vars:
        version: 1.5.4


    - name: Get Terraform
      unarchive:
        src: https://releases.hashicorp.com/terraform/{{ version }}/terraform_{{ version }}_{{ os }}_amd64.zip
        dest: "{{ target_directory }}/.bin/"
        creates: "{{ target_directory }}/.bin/terraform"
        remote_src: yes
      vars:
        version: 0.12.20


    - name: Get tflint
      unarchive:
        src: https://github.com/terraform-linters/tflint/releases/download/v{{ version }}/tflint_{{ os }}_amd64.zip
        dest: "{{ target_directory }}/.bin/"
        creates: "{{ target_directory }}/.bin/tflint"
        remote_src: yes
      vars:
        version: 0.14.0


    - name: Get Vault
      unarchive:
        src: https://releases.hashicorp.com/vault/{{ version }}/vault_{{ version }}_{{ os }}_amd64.zip
        dest: "{{ target_directory }}/.bin/"
        creates: "{{ target_directory }}/.bin/vault"
        remote_src: yes
      vars:
        version: 1.3.2

# vim: syntax=ansible
