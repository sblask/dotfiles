---
- hosts: localhost
  connection: local
  become: true
  tasks:

    - name: Add Geary repository
      apt_repository:
        repo: ppa:geary-team/releases
        state: present
    - name: Install Geary
      apt:
        name: geary
        state: present

    - name: Add Neovim repository
      apt_repository:
        repo: ppa:neovim-ppa/stable
        state: present
    - name: Install Neovim
      apt:
        name: neovim
        state: present

    - name: Ensure useful packages are installed
      apt:
        name: "{{ item }}"
        state: present
      with_items:
        - entr
        - gmusicbrowser
        - gnome-font-viewer
        - gparted
        - inkscape
        - libreoffice
        - pdftk
        - pinta
        - puddletag
        - silversearcher-ag
        - texlive
        - tree
        - usb-creator-gtk
        - vlc

    - name: Ensure useless packages are removed
      apt:
        name: "{{ item }}"
        state: absent
      with_items:
        - gnome-mines
        - gnome-sudoku
        - indicator-messages
        - parole
        - pidgin
        - ristretto



- hosts: localhost
  connection: local
  vars:
    home_directory: "{{ lookup('env', 'HOME') }}"
  tasks:

    - name: Find files to symlink
      find:
        patterns:  "*.symlink"
        paths: "{{ playbook_dir }}"
        recurse: yes
      register: files_to_symlink
    - name: Ensure directories for symlinks
      file:
        path: "{{ home_directory }}/{{ item.path.replace(playbook_dir, '').replace('.symlink', '').rsplit('/', 1)[0] }}"
        state: directory
      with_items: "{{ files_to_symlink.files }}"
    - name: Create symlinks
      file:
        src: "{{ item.path }}"
        dest: "{{ home_directory }}/{{ item.path.replace(playbook_dir, '').replace('.symlink', '') }}"
        state: link
      with_items: "{{ files_to_symlink.files }}"
