#!/bin/bash

SERVERS="$@"
SESSION_NAME=cssh

tmux new-session -d -s $SESSION_NAME
tmux new-window -t $SESSION_NAME -n "ssh $(echo $SERVERS | awk '{split($0,a,"-"); print a[1], a[2]}')"

shift
for SERVER in $SERVERS; do
  tmux split-window "ssh $SERVER"
  tmux select-layout tiled
done
tmux kill-pane -t 0
tmux select-pane -t 0
tmux select-layout tiled
tmux set-window-option synchronize-panes on
tmux -2 attach -t $SESSION_NAME

