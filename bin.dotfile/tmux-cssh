#!/bin/bash

SERVERS="$@"
WINDOW_NAME="ssh_$(echo $SERVERS | awk '{split($0,a,"-"); printf "%s_%s", a[1], a[2]}')"

if [[ -z "$TMUX" ]]; then
  if tmux has-session; then
    tmux new-window
  else
    tmux new-session -d
  fi
else
  tmux new-window
fi

tmux rename-window $WINDOW_NAME

shift
for SERVER in $SERVERS; do
  tmux split-window "ssh $SERVER"
  tmux select-layout tiled
done
tmux kill-pane -t 0
tmux select-pane -t 0
tmux select-layout tiled
tmux set-window-option synchronize-panes on

